<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Checkout - ShopMaterial</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- Navbar is handled by your script.js (updateNavbar) -->
  <div class="container py-5">
    <div class="row">
      <div class="col-lg-7">
        <h3 class="mb-4">Checkout</h3>

        <div id="checkout-items" class="list-group mb-4">
          <!-- Items populated by script.js -> loadCheckout() -->
        </div>

        <div class="card p-3 mb-4">
          <h5 class="mb-3">Choose Payment Method</h5>

          <div id="payment-options" class="mb-3">
            <div class="form-check">
              <input class="form-check-input" type="radio" name="paymentMethod" id="pay_card" value="card" checked>
              <label class="form-check-label" for="pay_card">Card / Debit / Credit</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="paymentMethod" id="pay_upi" value="upi">
              <label class="form-check-label" for="pay_upi">UPI (PhonePe / Google Pay)</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="paymentMethod" id="pay_cod" value="cod">
              <label class="form-check-label" for="pay_cod">Cash on Delivery (COD)</label>
            </div>
          </div>

          <div class="d-flex gap-2">
            <button id="pay-now" class="btn btn-primary" onclick="startCheckout()">Pay Now</button>
            <button class="btn btn-outline-secondary" onclick="window.location.href='cart.html'">Back to Cart</button>
          </div>
        </div>

      </div>

      <div class="col-lg-5">
        <aside class="card p-3">
          <h5>Order Summary</h5>
          <div class="d-flex justify-content-between my-2">
            <div>Items total</div>
            <div id="checkout-total">$0.00</div>
          </div>
          <div class="d-flex justify-content-between my-2">
            <div>Items</div>
            <div id="checkout-count">0</div>
          </div>
          <hr />
          <div class="d-flex justify-content-between fw-bold">
            <div>Payable</div>
            <div id="checkout-payable">$0.00</div>
          </div>
        </aside>
      </div>
    </div>
  </div>

  <!-- Simulated Payment Gateway Modal -->
  <div class="modal fade" id="gatewayModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Payment Gateway</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body text-center">
          <p id="gateway-msg">Processing payment...</p>
          <div id="gateway-spinner" class="spinner-border my-3" role="status"><span class="visually-hidden">Loading...</span></div>
          <div id="gateway-actions" class="d-none">
            <button class="btn btn-success me-2" id="gateway-success">Simulate Success</button>
            <button class="btn btn-danger" id="gateway-fail">Simulate Failure</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Success Modal (reuse your success UI if present) -->
  <div class="modal fade" id="orderSuccessModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content p-3 text-center">
        <div class="modal-body">
          <h4 class="text-success">Payment Success</h4>
          <p id="order-success-msg">Your order <strong id="order-id-span"></strong> has been placed.</p>
          <button class="btn btn-primary" id="go-to-orders">Go to Orders</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap + your script -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="script.js"></script>
  <script>
    // When this page loads, your script.js has loadCheckout() called in DOMContentLoaded.
    // Add a small helper binding:
    function startCheckout() {
      // Determine selected payment method
      const method = document.querySelector('input[name="paymentMethod"]:checked').value;
      // Call a helper that we've added to script.js
      if (typeof handleCheckoutStart === 'function') {
        handleCheckoutStart(method);
      } else {
        alert('Checkout handler not available.');
      }
    }

    // Quick hookup for "Go to Orders" button after success
    document.getElementById('go-to-orders').addEventListener('click', () => {
      window.location.href = 'profile.html'; // profile/orders page
    });
  </script>
</body>
</html>
